# Bunny Words - 间隔重复学习系统 (SRS) 说明文档

## 系统概述

Bunny Words 现在集成了基于 Anki 算法的**间隔重复学习系统 (Spaced Repetition System, SRS)**，实现智能化的单词复习管理。

## 核心功能

### 1. 首次学习 vs 复习模式

#### 首次学习
- 用户第一次进入某个 List 时，会学习该 List 的**所有单词**（例如 50 个）
- 学完所有单词后，系统标记该 List 为"首次学习完成"
- 进度显示正确：学完 20 个词显示 20/20（已修复）

#### 复习模式
- 首次学习完成后，再次进入该 List 时，**只显示需要复习的单词**
- 根据用户之前的评分（忘记/模糊/认识/熟练），系统自动计算每个单词的复习时间
- 只有到期需要复习的单词才会出现

### 2. 视觉状态反馈

#### List 卡片状态
- **正常状态**：有单词需要学习或复习，卡片正常显示
- **已完成状态**：所有单词已学完且无复习任务，卡片变淡（opacity: 50%）
- **需复习提示**：显示橙色标签"需复习 X 词"，并在"记忆卡片"按钮上显示小红点

### 3. Anki 评分系统

用户在记忆卡片模式下，可以对每个单词进行评分：

| 评分 | 含义 | 下次复习时间 |
|------|------|--------------|
| **忘记** (Again) | 完全不记得 | 1 分钟后 |
| **模糊** (Hard) | 有印象但不确定 | 10 分钟后 |
| **认识** (Good) | 能够回忆起来 | 1 天后 |
| **熟练** (Easy) | 非常熟悉 | 4 天后 |

### 4. 智能复习算法

- 系统根据用户的评分动态调整每个单词的复习间隔
- 评分越高，下次复习间隔越长
- 评分越低，复习频率越高
- 采用难度系数 (Ease Factor) 机制，个性化调整学习曲线

## 技术实现

### 数据结构

```typescript
interface WordProgress {
  wordId: string | number
  lastReviewDate: number      // 上次复习时间戳
  nextReviewDate: number       // 下次复习时间戳
  interval: number             // 复习间隔（分钟）
  easeFactor: number           // 难度系数
  reviewCount: number          // 复习次数
  rating: 'again' | 'hard' | 'good' | 'easy' | null
}

interface ListProgress {
  listId: string
  wordbookId: string
  words: Record<string, WordProgress>
  firstStudyCompleted: boolean  // 是否完成首次学习
  lastStudyDate: number
}
```

### 核心函数

1. **getListProgress()** - 获取 List 的学习进度
2. **getDueWords()** - 获取需要复习的单词列表
3. **updateWordProgress()** - 更新单词的学习进度
4. **isFirstStudy()** - 判断是否首次学习
5. **getListStats()** - 获取 List 的统计信息

### 数据存储

- 使用 `localStorage` 存储学习进度
- Key 格式：`srs_progress_{wordbookId}_{listId}`
- 数据持久化，刷新页面不丢失

## 用户体验流程

### 场景 1：首次学习
1. 用户点击"记忆卡片"进入 List 1
2. 系统显示该 List 的所有 50 个单词
3. 用户逐个学习，对每个单词进行评分
4. 学完 50 个单词后，自动返回 List 页面
5. List 1 显示"50 / 50 词"

### 场景 2：立即复习
1. 用户刚学完 List 1，其中 2 个词评分为"忘记"
2. List 1 显示"需复习 2 词"标签
3. 用户再次点击"记忆卡片"
4. 系统只显示这 2 个需要复习的单词
5. 复习完成后返回 List 页面

### 场景 3：定时复习
1. 用户学完 List 1 后过了 1 天
2. 系统检测到有 10 个单词到了复习时间
3. List 1 从变淡状态恢复正常，显示"需复习 10 词"
4. 用户进入后只学习这 10 个单词
5. 其他未到期的单词暂时不显示

### 场景 4：全部完成
1. 用户学完 List 1 的所有单词
2. 所有单词都已复习，且暂时没有到期的
3. List 1 卡片变淡，表示当前无学习任务
4. 随着时间推移，单词到期后卡片会自动恢复

## 优势

1. **科学高效**：基于艾宾浩斯遗忘曲线，在最佳时机复习
2. **个性化**：根据每个用户的掌握情况调整复习计划
3. **节省时间**：只复习需要复习的单词，避免重复学习已掌握的内容
4. **视觉反馈**：清晰的状态提示，让用户了解学习进度
5. **持久化**：数据本地存储，随时可以继续学习

## 未来优化方向

1. 添加学习统计图表
2. 支持自定义复习间隔
3. 添加学习提醒功能
4. 支持数据导出/导入
5. 添加学习成就系统

---

**注意**：当前系统使用 `localStorage` 存储数据，清除浏览器缓存会导致学习进度丢失。未来可以考虑添加云端同步功能。
